import React, { useState } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";

const API_KEY = "TA_CLE_API_OPENWEATHERMAP_ICI";

// Classification g√©ographique fictive selon la ville
const regionProfiles: Record<string, string> = {
  sydney: "littoral",
  paris: "urbaine",
  cairo: "d√©sertique",
  moscow: "continentale",
  miami: "tropicale",
  tokyo: "sismique",
};

const disastersByRegion: Record<string, string[]> = {
  littoral: ["Inondation c√¥ti√®re", "Temp√™te tropicale"],
  urbaine: ["Panne d'infrastructure", "Inflation urbaine"],
  d√©sertique: ["S√©cheresse s√©v√®re", "Temp√™te de sable"],
  continentale: ["Vague de froid", "Effondrement √©nerg√©tique"],
  tropicale: ["Ouragan", "Crise logistique"],
  sismique: ["S√©isme majeur", "Tsunami localis√©"],
};

const policySuggestions: Record<string, string> = {
  "Inondation c√¥ti√®re": "Mettre en place un plan de reconstruction des logements, renforcer les digues et investir dans la r√©silience c√¥ti√®re.",
  "Temp√™te tropicale": "Subventionner les PME affect√©es, r√©tablir les r√©seaux et lancer un plan de relance infrastructurel.",
  "Panne d'infrastructure": "Lancer un plan Marshall num√©rique et physique, et cr√©er des emplois publics temporaires.",
  "Inflation urbaine": "Geler les loyers, augmenter les subventions publiques et baisser la TVA temporairement.",
  "S√©cheresse s√©v√®re": "Investir dans le dessalement et l'irrigation, distribuer des aides agricoles cibl√©es.",
  "Temp√™te de sable": "Prot√©ger les infrastructures et financer des technologies anti-poussi√®re.",
  "Vague de froid": "Aider les m√©nages vuln√©rables avec des primes √©nergie, subventionner le chauffage.",
  "Effondrement √©nerg√©tique": "Diversifier les sources d'√©nergie et imposer des √©conomies contr√¥l√©es.",
  "Ouragan": "Cr√©er un fonds de catastrophe, aider √† la reconstruction et renforcer les normes de construction.",
  "Crise logistique": "All√©ger les contraintes douani√®res et subventionner les cha√Ænes d'approvisionnement locales.",
  "S√©isme majeur": "Mettre en place un programme de reconstruction rapide et de logement d'urgence.",
  "Tsunami localis√©": "Cr√©er un plan d'√©vacuation, relancer le tourisme local et s√©curiser les ports.",
};

const EconomicDisasterSim = () => {
  const [city, setCity] = useState("");
  const [weather, setWeather] = useState<any>(null);
  const [region, setRegion] = useState<string>("");
  const [disaster, setDisaster] = useState<string>("");
  const [policy, setPolicy] = useState<string>("");

  const fetchWeather = async () => {
    if (!city) return;
    const res = await fetch(
      `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${API_KEY}&units=metric`
    );
    const data = await res.json();
    setWeather(data);

    const regionType = regionProfiles[city.toLowerCase()] || "urbaine";
    setRegion(regionType);

    const disasters = disastersByRegion[regionType];
    const chosen = disasters[Math.floor(Math.random() * disasters.length)];
    setDisaster(chosen);
    setPolicy(policySuggestions[chosen]);
  };

  return (
    <div className="max-w-2xl mx-auto mt-10 p-6 bg-white rounded-2xl shadow-lg space-y-4">
      <h1 className="text-3xl font-bold">üåê Simulateur de Crise √âconomique et M√©t√©o</h1>
      <p className="text-gray-600">Tape ta ville pour devenir Ministre de l'√âconomie en cas de catastrophe naturelle locale.</p>
      <Input
        placeholder="Ex: Sydney, Paris, Cairo, Miami, Tokyo, etc."
        value={city}
        onChange={(e) => setCity(e.target.value)}
      />
      <Button onClick={fetchWeather}>Simuler</Button>

      {weather && (
        <Card>
          <CardContent className="space-y-3 p-4">
            <p><strong>Ville :</strong> {weather.name}</p>
            <p><strong>Temp√©rature :</strong> {weather.main.temp} ¬∞C</p>
            <p><strong>Conditions m√©t√©o :</strong> {weather.weather[0].description}</p>
            <p><strong>R√©gion g√©ographique :</strong> {region}</p>
            <p className="text-red-600 font-semibold">üö® Catastrophe d√©tect√©e : {disaster}</p>
            <p className="text-blue-700 font-semibold">üßë‚Äçüíº Ministre de l'√âconomie ‚Äî strat√©gie propos√©e :</p>
            <p className="text-green-700">{policy}</p>
          </CardContent>
        </Card>
      )}
    </div>
  );
};

export default EconomicDisasterSim;


